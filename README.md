Давайте создадим свой простой токен в Ethereum. Это будет полностью работоспособный токен стандарта ERC20. Его можно будет добавить в Метамаск, отправить друзьям и даже использовать в ICO.


Чтобы лучше понять как работают токены и смарт-контракты давайте прыгнем сразу с места в карьер — создадим в тестовой сети Ethereum Ropsten простой токен. Я думаю лучше начать изучение смарт-контрактов именно так, чтобы почувствовать вкус происходящего. Пока что предварительно вам знать ничего не надо, просто делайте как описано ниже. Уже потом в процессе изучения последующих уроков вы поймете что значит та или иная функция.

На заметку: смарт-контрактом называется любой код, работающий в сети Эфира. Будь то токен или игра, или аукцион или еще что — все это смарт-контракты.
Что нам потребуется?

Метамаск
сайт http://remix.ethereum.org/
сайт https://www.myetherwallet.com/
Никаких установок Geth и долгих мучительных скачиваний блокчейна не требуется.

Итак, установите Метамаск, если он у вас еще не установлен и переключитесь на тестовую сеть Ropsten. Если у вас есть реальные эфиры в реальной сети и вы хотите сделать токен в реальной сети, то останьтесь в Mainnet. Комиссия за создание токена составит примерно 0,05-0,06 эфира.

Если создаете токен в тестовой сети, то зайдите на фаусет https://faucet.metamask.io/ и получите там 1 эфир, он будет нужен для оплаты комиссии.

Тестовая сеть идентична реальной и используется для бесплатных экспериментов со смарт-контрактами.

Код токена
Ниже размещен код нашего токена. Это простой токен. Что я подразумеваю под простым токеном? Есть токены с краудсейлами, баунти, эирдропами и т.д. У нас же будет простой токен без всех этих вещей, в последующих уроках напишем и краудсейлы, и баунти и т.д. Несмотря на то что это простой токен, он вполне работоспособен и соответствует стандарту ERC20. Эмиссия токена будет составлять 10 000 000 (десять миллионов) штук, токен будет называться SET, описанием будет Simple Ethereum Token. Название, описание и количествово токенов можно изменить в первых строчках кода.

Откройте сайт http://remix.ethereum.org, удалите имеющийся там код и вставьте код нашего токена.

В Remix-е перейдите на вкладку Settings и измените версию Solidity на 0.4.21

Настройка Remix

После этого вернитесь на вкладку Compile и нажмите Start to compile. Дождитесь окончания компиляции (обычно несколько секунд) и нажмите на Details.

Откроется всплывающее окно с необходимыми нам данными — Байткодом и ABI. В байткоде нам необходимо скопировать то, что находится в поле object: от кавычек до кавычек. Скопируйте и сохраните в блокнот или другой редактор, ABI скопируйте полностью и тоже сохраните в блокнот. В моем случае Bytecode и ABI выглядят так:

Деплоим смарт-контракт в MyEtherWallet
Теперь открывайте https://www.myetherwallet.com/ — именно здесь мы задеплоим наш контракт. Если вы хотите создать токен в тестовой сети, то в правом верхнем выпадающем списке выберите Network Ropsten (Myetherapi.com). Если в реальной сети, то останьтесь в ETH (Myetherapi). Я буду создавать токен в тестовой сети.
В верхнем меню выберите контракт и нажмите подменю Опубликовать контракт.

В поле Байткод вставьте байткод (тот, который копировали от кавычек до кавычек)
В поле Лимит газа автоматически рассчитается значение лимита (сами ничего в него не пишите)
Теперь ниже нужно вставить приватный ключ от нашего кошелька чтобы отпереть его и произвести транзакцию создания токена. Сделайте это и нажмите Отпереть.
После этого жмите Подписать транзакцию и Опубликовать контракт. В сплывающем окне подтвердите.
Вот и готов наш токен. Теперь его нужно добавить в Метамаск или MyEtherWallet. Для этого нам потребуется адрес контракта. Запомните: при деплое любого контракта блокчейн Эфира автоматически создает адрес контракта. Не путайте его с адресом своего кошелька.

Чтобы узнать адрес созданного контракта перейдите в https://ropsten.etherscan.io и введите в поиск адрес своего кошелька. В списке транзакций вы увидите запись под названием Contract Creation. Выглядит это так:

Жмите на Contract Creation и перейдете на страницу со своим контрактом. Копируйте адрес контракта и добавляйте его в Метамаск или MyEtherWallet, а после этого можете рассылать свой токен друзьям и знакомым.

Стоимость деплоя смарт-контракта
Апдейт от 11.08.2018

Вы можете видеть что в нашем контракте есть определенное количество переменных и функций. Каждая переменная и функция стоит определенное количество газа — запомните это! Чем больше функций будет в нашем токене, тем больше газа он потребует на свой деплой. В Эфире есть такое понятие как лимит газа, он плавающий и составляет примерно 7 000 000. Это сделано для того чтобы какой-нибудь «хороший» гражданин не надумал сделать бесконечный цикл, например. Наш вышесозданный контракт требует примерно 1 000 000 газа. Это значит что вы не сможете задеплоить контракт, состоящий, например, из 10 000 строчек кода и выполняющий невообразимые вещи. Это возможно, но код придется разносить по нескольким контрактам и деплоить их по отдельности. Например игры, созданные на Ethereum, могут состоять из 10-20-30 контрактов, подключающихся друг к другу с помощью интерфейсов. Но об этом поговорим в следубщих уроках.

Есть хороший сайт https://ethgasstation.info/  . Сайт показывает текущую стоимость газа в гвеях.
На скриншоте я отметил то, на что надо обратить внимание.

Предположим, вам надо задеплоить контракт или просто перевести Эфиры со своего адреса на адрес биржи. Вы заходите на этот сайт, смотрите сколько стоит сейчас газ, потом открываете Метамаск и при совершении транзакции указываете немного большее количество гвеев, чем указано. Если на скриншоте сейчас 3,1 , то в Метамаске укажите 3,5 (обязательно через запятую).

Почему это важно? Метамаск научился определять нужное кол-во гвеев, однако он не учитывает цифры после запятой. То есть если газ стоит 3,1 ,  Метамаск предложит вам 3. И этой самой 0,1 может не хватить вам для проведения транзакции, она будет висеть в пендингах часы или даже сутки. Поэтому всегда немножко прибавляйте.

Вначале статьи я написал что деплой контракта вам обойдется в 0,05-0,06 эфира. Это при стоимости газа в 21 гвей. Вы можете (не) много сэкономить если будете смотреть стоимость газа на https://ethgasstation.info/. При стоимости газа 3,5 контракт обойдется уже в 0.0135 ETH. Если сеть сейчас штормит и стоимость зашкаливает за 60-70 гвей (что стало не редкостью), то иногда стоит подождать несколько часов пока все устаканится.

